import { NextRequest, NextResponse } from "next/server";
import { createPost } from "@/lib/wp";
import { mdToHtml } from "@/lib/markdown";
export async function POST(req: NextRequest){try{const form=await req.formData();const title=String(form.get("title")||"");const slug=form.get("slug")?String(form.get("slug")):undefined;const excerpt=form.get("excerpt")?String(form.get("excerpt")):undefined;const contentMd=String(form.get("content")||"");const status=(String(form.get("status")||"draft")==="publish")?"publish":"draft";const categories=String(form.get("categories")||"").split(",").map(s=>parseInt(s.trim())).filter(n=>!isNaN(n));const tags=String(form.get("tags")||"").split(",").map(s=>parseInt(s.trim())).filter(n=>!isNaN(n));const featured_media=form.get("featured_media")?parseInt(String(form.get("featured_media"))):undefined;const html=mdToHtml(contentMd) as string;const payload:any={title,slug,excerpt,content:html,status,categories:categories.length?categories:undefined,tags:tags.length?tags:undefined,featured_media,};const seoTitle=form.get("seo_title")?String(form.get("seo_title")):undefined;const seoDescription=form.get("seo_description")?String(form.get("seo_description")):undefined;const seoFocusKw=form.get("seo_focuskw")?String(form.get("seo_focuskw")):undefined;if(seoTitle||seoDescription||seoFocusKw){payload.meta={...(payload.meta||{}),_yoast_wpseo_title:seoTitle,_yoast_wpseo_metadesc:seoDescription,_yoast_wpseo_focuskw:seoFocusKw,};}const post=await createPost(payload);return NextResponse.json({ok:true,post});}catch(e:any){return NextResponse.json({ok:false,error:e.message},{status:500});}}
